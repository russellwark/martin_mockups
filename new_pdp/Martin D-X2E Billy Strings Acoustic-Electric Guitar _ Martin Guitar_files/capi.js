!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self)["fx-capi"]={})}(this,function(e){function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e){var t,n=("; "+document.cookie).split("; "+e+"=");return 2===n.length?null==(t=n.pop())?void 0:t.split(";").shift():null}function a(e){return new URLSearchParams(window.location.search).get(e)}var o,i,c={fb:function(e,t){e.fb.user_data={fbc:"",fbp:""};var n=r("_fbp");n&&(e.fb.user_data.fbp=n);var o=r("_fbc");o?e.fb.user_data.fbc=o:a("fbclid")&&(e.fb.user_data.fbc="fb.1."+t+"."+a("fbclid"))},ln:function(e,t){},pn:function(e,t){e.pn.user_data={action_source:"web"}}};function f(e,t){if(void 0!==e&&void 0!==t)if("track"===e||"config"===e)if("object"==typeof t)if(0!==Object.keys(t).length)if("config"!==e){var n=Math.floor(Date.now()/1e3);for(var r in t){var a=r;if(!c[a])return void console.warn('fx_capi "data" key "'+a+'" is not supported. Must be one of: '+Object.keys(c).join(", "));c[a](t,n);var o=t[r].event,i=t[r].id;if(!o||"object"!=typeof o&&"string"!=typeof o)return void console.warn("fx_capi data event must be an object or a string");if(!i||"string"!=typeof i)return void console.warn("fx_capi data id must be a string")}var f=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);t.event_source_url=window.location.href,t.client_user_agent=navigator.userAgent,t.capi_key=f,t.timestamp=n;var s=JSON.stringify({event:e,data:t}),u=new Blob([s],{type:"application/json"});navigator.sendBeacon("https://t.webfxcapi.com/events",u)}else for(var d in t)"auto_track"===d&&(window.fx_capi.auto_track=Boolean(t[d]));else console.warn('fx_capi "data" object is empty');else console.warn('fx_capi "data" must be an object');else console.warn('fx_capi only supports the "track" and "config" events');else console.warn('fx_capi: "event" and "data" arguments are required')}!function(){if(window.fx_capi&&window.fx_capi.q&&Array.isArray(window.fx_capi.q)){for(var e,t=n(window.fx_capi.q);!(e=t()).done;){var r=e.value;f(r[0],r[1])}window.fx_capi.q=[]}}();var s=null!=(o=null==(i=window.fx_capi)?void 0:i.auto_track)&&o;window.fx_capi=Object.assign(f,{auto_track:s}),function(){if(PerformanceObserver.supportedEntryTypes.includes("resource")){var e=new PerformanceObserver(function(e){for(var t,r=function(){var e,n=t.value;if(null!=(e=window.fx_capi)&&e.auto_track)if(n.name.includes("facebook.com/tr/")){var r,a=new URL(n.name).searchParams,o=a.get("ev")||"",i=a.get("id")||"",c=a.get("eid")||"",s=a.get("ts")||"",u=a.get("it")||"",d=a.get("dl")||"",l={};a.forEach(function(e,t){if(t.startsWith("cd[")){var n=t.replace("cd[","").replace("]","");try{l[n]=JSON.parse(e)}catch(t){l[n]=e}}}),f("track",{fb:{id:i,eventId:c,ts:s,it:u,dl:d,event:Object.keys(l).length>0?(r={},r[o]=l,r):o}})}else if(n.name.includes("pinterest.com/v3/?event=")){var p,v=new URL(n.name).searchParams,b=v.get("event")||"",g=v.get("tid")||"",w=v.get("ed")||"";f("track",{pn:{id:g,event:Object.keys(w).length>0?(p={},p[b]=JSON.parse(w),p):b}})}},a=n(e.getEntries());!(t=a()).done;)r()});e.observe({entryTypes:["resource"]})}}(),e.fx_capi=f});
//# sourceMappingURL=capi.js.map
